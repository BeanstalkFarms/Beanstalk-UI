import React, { useState } from 'react';
import { useSelector } from 'react-redux';
import { Box } from '@mui/material';
import { AppState } from 'state';
import { BaseModule, FarmAsset, ListTable, fieldStrings } from 'components/Common';

export default function PlotsTable() {
  /* App state */
  const {
    harvestablePodBalance,
    plots,
    harvestablePlots,
  } = useSelector<AppState, AppState['userBalance']>(
    (state) => state.userBalance
  );
  const { harvestableIndex } = useSelector<AppState, AppState['weather']>(
    (state) => state.weather
  );

  /* Local state */
  const [sectionInfo, setSectionInfo] = useState(0);
  const [page, setPage] = useState(0);

  const handleTabInfoChange = (event, newSectionInfo, newPageZero) => {
    setSectionInfo(newSectionInfo);
    setPage(newPageZero);
  };
  const handlePageChange = (event, newPage) => {
    setPage(newPage);
  };

  //
  const sectionTitlesInfo = [];
  const sectionsInfo = [];
  if (
    plots !== undefined &&
    (Object.keys(plots).length > 0 || harvestablePodBalance.isGreaterThan(0))
  ) {
    sectionsInfo.push(
      <ListTable
        asset={FarmAsset.Pods}
        claimableBalance={harvestablePodBalance}
        claimableCrates={harvestablePlots}
        crates={plots}
        description="Sown Plots will show up here."
        handleChange={handlePageChange}
        indexTitle="Place in Line"
        index={parseFloat(harvestableIndex)}
        page={page}
        title="Plots"
      />
    );
    sectionTitlesInfo.push('Plots');
  }

  const showListTables =
    sectionsInfo.length > 0 ? (
      <Box style={{ display: 'block', marginTop: '61px' }}>
        <BaseModule
          handleTabChange={handleTabInfoChange}
          section={sectionInfo}
          sectionTitles={sectionTitlesInfo}
          sectionTitlesDescription={[fieldStrings.plotTable]}
          showButton={false}
        >
          {sectionsInfo[sectionInfo]}
        </BaseModule>
      </Box>
    ) : null;

  return (
    <>{showListTables}</>
  );
}
